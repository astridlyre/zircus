# Settings in the [build] context are global and are applied to all contexts
# unless otherwise overridden by more specific contexts.
[build]
  # Directory to change to before starting a build.
  # This is where we will look for package.json/.nvmrc/etc.
  # If not set, defaults to the root directory.
  # Directory that contains the deploy-ready HTML files and assets generated by
  # the build. This is relative to the base directory if one has been set, or the
  # root directory if a base has not been set. This sample publishes the
  # directory located at the absolute path "root/project/build-output"
  publish = "_site/"

  # Default build command.
  command = "bundle exec jekyll build"

[[plugins]]
  package = "netlify-plugin-minify-html"

  [plugins.inputs]
  contexts = [
    'production',
    'branch-deploy',
    'deploy-preview'
  ]

  # Optionally, override the default options for the minification
  # https://github.com/kangax/html-minifier#options-quick-reference
  [plugins.inputs.minifierOptions]
  removeComments = true
  collapseInlineTagWhitespace = true

[[plugins]]
  package = "netlify-plugin-a11y"

  [plugins.inputs]
  checkPaths = ['/']

[[plugins]]
  package = "netlify-plugin-jekyll-cache"

  # Specify which deploy contexts we'll minify HTML in.
  # Supports any Deploy Contexts available in Netlify.
  # https://docs.netlify.com/site-deploys/overview/#deploy-contexts
  [plugins.inputs]
  jekyllSource = "/jekyll"

# A basic redirect rule
[[redirects]]
  from ="/fr/*"
  to ="/fr/404.html"
  status = 404

[[redirects]]
  from = "/*"
  to = "/404.html"
  status = 404

# A redirect rule with many of the supported properties
[[redirects]]
  from = "/"
  to = "/fr"

  # By default, redirects won’t be applied if there’s a file with the same
  # path as the one defined in the `from` property. Setting `force` to `true`
  # will make the redirect rule take precedence over any existing files.
  force = true

  # Redirect based on conditions including browser language, geolocation, 
  # identity role, and/or cookie presence.
  conditions = {Language = ["fr"], Country = ["CA"]}

[[headers]]
  # Define which paths this specific [[headers]] block will cover.
  for = "/*"

  [headers.values]
  X-Frame-Options = "DENY"
  X-XSS-Protection = "1; mode=block"
  X-Content-Type-Options = "nosniff"
  Content-Security-Policy = "default-src 'self' https://fonts.gstatic.com https://js.stripe.com https://www.paypal.com https://zircus.herokuapp.com *.cloudfront.net; img-src 'self' *.cloudfront.net data:; script-src 'self' https://js.stripe.com/ https://www.sandbox.paypal.com/ https://www.paypal.com/ *.cloudfront.net;"
  Cache-Control = "public, max-age=86400, immutable"

