(()=>{"use strict";const e=e=>document.getElementById(e),t="https://zircus.herokuapp.com/api",a=new class{constructor(){this.__hooks=[]}get hooks(){return this.__hooks}addHook(e){return this.__hooks.push(e),this}get inv(){const e=localStorage.getItem("inv");return e?JSON.parse(e):[]}set inv(e){return localStorage.setItem("inv",JSON.stringify(e(this.inv))),this.update()}get countries(){const e=localStorage.getItem("countries");return e?JSON.parse(e):[]}set countries(e){return localStorage.setItem("countries",JSON.stringify(e(this.countries))),this.update()}set cart(e){return localStorage.setItem("cart",JSON.stringify(e(this.cart))),this.update()}get cart(){const e=localStorage.getItem("cart");return e?JSON.parse(e):[]}get secret(){const e=localStorage.getItem("clientSecret");return e?JSON.parse(e):null}set secret(e){localStorage.setItem("clientSecret",JSON.stringify(e))}update(){return this.hooks.forEach((e=>e({cart:this.cart,inv:this.inv,countries:this.countries}))),this}};class n{constructor(e,t,a){if(this.e=document.createElement(e),this.children=[],t&&t.forEach((e=>{this.e.classList.add(e)})),a)for(const[e,t]of Object.entries(a))this.e.setAttribute(e,t)}render(){return this.children.forEach((e=>{e instanceof n?this.e.appendChild(e.render()):this.e.innerText=e})),this.e}event(e,t){return this.e.addEventListener(e,(()=>t())),this}addChild(e){return this.children.push(e),this}}function o(e,t){let a=e;return()=>t(a=!a)}const i=async()=>await fetch(`${t}/inv`).then((e=>e.json())).then((e=>a.inv=()=>[...e.cf,...e.pf,...e.ff])).catch((e=>{console.error("Unable to get inventory",e.message)}));i(),setInterval(i,3e5),(e=>{if(!e)return;const t=["For your thunder down under","Guard the crown jewels","For your national treasure","A luxury condo for your privates","If you are here, you may be gay","Protect and serve your genitals","Contain your thunder in style","A stylish shape for your bits","One person's junk is another's treasure"];e.innerText=t[Math.floor(Math.random()*t.length)]})(e("home-heading"));const s={Canada:{states:[{id:872,name:"Alberta",state_code:"AB"},{id:875,name:"British Columbia",state_code:"BC"},{id:867,name:"Manitoba",state_code:"MB"},{id:868,name:"New Brunswick",state_code:"NB"},{id:877,name:"Newfoundland and Labrador",state_code:"NL"},{id:878,name:"Northwest Territories",state_code:"NT"},{id:874,name:"Nova Scotia",state_code:"NS"},{id:876,name:"Nunavut",state_code:"NU"},{id:866,name:"Ontario",state_code:"ON"},{id:871,name:"Prince Edward Island",state_code:"PE"},{id:873,name:"Quebec",state_code:"QC"},{id:870,name:"Saskatchewan",state_code:"SK"},{id:869,name:"Yukon",state_code:"YT"}]},"United States":{states:[{id:1456,name:"Alabama",state_code:"AL"},{id:1400,name:"Alaska",state_code:"AK"},{id:1424,name:"American Samoa",state_code:"AS"},{id:1434,name:"Arizona",state_code:"AZ"},{id:1444,name:"Arkansas",state_code:"AR"},{id:1402,name:"Baker Island",state_code:"UM-81"},{id:1416,name:"California",state_code:"CA"},{id:1450,name:"Colorado",state_code:"CO"},{id:1435,name:"Connecticut",state_code:"CT"},{id:1399,name:"Delaware",state_code:"DE"},{id:1437,name:"District of Columbia",state_code:"DC"},{id:1436,name:"Florida",state_code:"FL"},{id:1455,name:"Georgia",state_code:"GA"},{id:1412,name:"Guam",state_code:"GU"},{id:1411,name:"Hawaii",state_code:"HI"},{id:1398,name:"Howland Island",state_code:"UM-84"},{id:1460,name:"Idaho",state_code:"ID"},{id:1425,name:"Illinois",state_code:"IL"},{id:1440,name:"Indiana",state_code:"IN"},{id:1459,name:"Iowa",state_code:"IA"},{id:1410,name:"Jarvis Island",state_code:"UM-86"},{id:1428,name:"Johnston Atoll",state_code:"UM-67"},{id:1406,name:"Kansas",state_code:"KS"},{id:1419,name:"Kentucky",state_code:"KY"},{id:1403,name:"Kingman Reef",state_code:"UM-89"},{id:1457,name:"Louisiana",state_code:"LA"},{id:1453,name:"Maine",state_code:"ME"},{id:1401,name:"Maryland",state_code:"MD"},{id:1433,name:"Massachusetts",state_code:"MA"},{id:1426,name:"Michigan",state_code:"MI"},{id:1438,name:"Midway Atoll",state_code:"UM-71"},{id:1420,name:"Minnesota",state_code:"MN"},{id:1430,name:"Mississippi",state_code:"MS"},{id:1451,name:"Missouri",state_code:"MO"},{id:1446,name:"Montana",state_code:"MT"},{id:1439,name:"Navassa Island",state_code:"UM-76"},{id:1408,name:"Nebraska",state_code:"NE"},{id:1458,name:"Nevada",state_code:"NV"},{id:1404,name:"New Hampshire",state_code:"NH"},{id:1417,name:"New Jersey",state_code:"NJ"},{id:1423,name:"New Mexico",state_code:"NM"},{id:1452,name:"New York",state_code:"NY"},{id:1447,name:"North Carolina",state_code:"NC"},{id:1418,name:"North Dakota",state_code:"ND"},{id:1431,name:"Northern Mariana Islands",state_code:"MP"},{id:4851,name:"Ohio",state_code:"OH"},{id:1421,name:"Oklahoma",state_code:"OK"},{id:1415,name:"Oregon",state_code:"OR"},{id:1448,name:"Palmyra Atoll",state_code:"UM-95"},{id:1422,name:"Pennsylvania",state_code:"PA"},{id:1449,name:"Puerto Rico",state_code:"PR"},{id:1461,name:"Rhode Island",state_code:"RI"},{id:1443,name:"South Carolina",state_code:"SC"},{id:1445,name:"South Dakota",state_code:"SD"},{id:1454,name:"Tennessee",state_code:"TN"},{id:1407,name:"Texas",state_code:"TX"},{id:1432,name:"United States Minor Outlying Islands",state_code:"UM"},{id:1413,name:"United States Virgin Islands",state_code:"VI"},{id:1414,name:"Utah",state_code:"UT"},{id:1409,name:"Vermont",state_code:"VT"},{id:1427,name:"Virginia",state_code:"VA"},{id:1405,name:"Wake Island",state_code:"UM-79"},{id:1462,name:"Washington",state_code:"WA"},{id:1429,name:"West Virginia",state_code:"WV"},{id:1441,name:"Wisconsin",state_code:"WI"},{id:1442,name:"Wyoming",state_code:"WY"}]}};a.countries=()=>s;const r=Stripe("pk_test_51J93KzDIzwSFHzdzCZtyRcjMvw8em0bhnMrVmkBHaMFHuc2nkJ156oJGNxuz0G7W4Jx0R6OCy2nBXYTt6U8bSYew00PIAPcntP"),c=/^[A-Za-z][0-9][A-Za-z] ?[0-9][A-Za-z][0-9]$/,d=/^[0-9]{5}(-[0-9]{4})?$/;!function(){const t=e("product-prefix");if(!t)return;const i=e("product-price"),s=e("product-price-text"),r=e("product-size"),c=e("product-image"),d=e("product-image-full"),u=e("product-image-full-image"),l=e("product-quantity"),m=e("product-color"),h=e("product-default-color"),p=e("add-to-cart"),v=e("go-to-cart"),y=e("go-to-cart-qty"),f=e("product-accent"),_=e("product-stock");let b=m.value;const[g,k]=(()=>{let e=null;return[()=>e,()=>e=a.inv.find((e=>e.type===`${t.value}-${m.value}-${r.value}`))]})();function N(e){return g()&&(c.src=g().images[e])}k();const C=o(!1,(e=>N(e?"sm_b":"sm_a"))),x=o(!1,(e=>{e?(u.src=g().images.lg_a,d.style.display="flex",document.body.classList.add("hide-y")):(d.style.display="none",document.body.classList.remove("hide-y"))}));function L(e){for(const a of["a-400.png","b-400.png","a-1920.jpg"]){const o=new n("link",null,{href:`/assets/img/products/masked/${t.value}-${e}-${a}`,rel:"prefetch",as:"image"});document.head.appendChild(o.render())}}for(const e of m.children)L(e.value),e.value===h.value&&(e.setAttribute("selected",!0),f.classList.add(`${e.value}-before`),b=e.value);function S(){const e=a.cart.reduce(((e,t)=>e+t.quantity),0);y.innerText=e>0?`(${e})`:""}function $(){if(!a.inv)return;const e=k();e&&0!==e.quantity?function(e){_.innerText=e.quantity>5?"In stock":`Only ${e.quantity} left`,e.quantity<Number(l.value)&&(l.value=e.quantity),_.classList.add("in-stock"),_.classList.remove("out-stock"),l.removeAttribute("disabled"),p.removeAttribute("disabled"),p.textContent="add to cart"}(e):(_.innerText="None available",_.classList.add("out-stock"),_.classList.remove("in-stock"),l.setAttribute("disabled",!0),p.setAttribute("disabled",!0),p.innerText="out of stock"),N("sm_a"),s.textContent="$"+Number(i.value)*Number(l.value)}$(),S(),m.addEventListener("change",(()=>{N("sm_a"),$(),f.classList.add(`${m.value}-before`),f.classList.remove(`${b}-before`),b=m.value})),l.addEventListener("input",(()=>{const e=g().quantity;Number(l.value)>e&&(l.value=e),s.textContent="$"+Number(l.value)*Number(i.value)})),r.addEventListener("input",$),c.addEventListener("pointerover",(()=>C())),c.addEventListener("pointerleave",(()=>C())),c.addEventListener("click",(()=>x())),d.addEventListener("click",(()=>x())),p.addEventListener("click",(function(){const e=g();e.quantity-Number(l.value)<0||!e.quantity||(a.cart.find((t=>t.type===e.type))?function(e){a.cart=t=>t.map((t=>t.type===e.type?{...t,quantity:t.quantity+Number(l.value)}:t))}(e):function(e){a.cart=t=>t.concat({...e,quantity:Number(l.value)})}(e),p.blur())})),v.addEventListener("click",(()=>location.assign("/cart"))),a.addHook($),a.addHook(S)}(),function(){if(!e("place-order"))return;0===a.cart.length&&location.assign("/");const o=e("checkout-name"),i=e("checkout-email"),s=e("checkout-street"),u=e("checkout-city"),l=e("checkout-state"),m=e("checkout-state-text"),h=e("checkout-country"),p=e("checkout-zip"),v=e("checkout-zip-text"),y=e("stripe-payment-modal"),f=e("stripe-payment-form"),_=e("pay-button"),b=e("card-error"),g=e("spinner"),k=e("button-text"),N=e("checkout-form"),C=e("cancel"),x=e("checkout-subtotal"),L=e("checkout-tax"),S=e("checkout-total"),$=e("checkout-product-template"),A=e("checkout-products");let I=!1;function M(e){e?(_.disabled=!0,g.classList.remove("hidden"),k.classList.add("hidden")):(_.disabled=!1,g.classList.add("hidden"),k.classList.remove("hidden"))}function w(){const e=a.cart.reduce(((e,t)=>e+t.price*t.quantity),0),t=e*((e,t)=>{if("Canada"!==e)return.05;switch(t){case"New Brunswick":case"Newfoundland and Labrador":case"Nova Scotia":case"Prince Edward Island":return.15;case"Ontario":return.13;default:return.05}})(h.value,l.value),n=e+t;x.innerText=`$${e.toFixed(2)}`,L.innerText=`$${t.toFixed(2)}`,S.innerText=`$${n.toFixed(2)}`}function q(e,t=[],a){e.textContent="",t.forEach((t=>{e.appendChild(new n("option",null,{value:a(t)}).addChild(a(t)).render())}))}function E(t){M(!1),t?(document.body.classList.add("hide-y"),e("blur").classList.add("blur"),y.classList.add("show-modal"),_.disabled=!0,e("payment-price").innerText=S.textContent):(document.body.classList.remove("hide-y"),e("blur").classList.remove("blur"),y.classList.remove("show-modal"),0===a.cart.length&&location.assign("/"))}function T(){const e=h.value;l.textContent="",q(l,a.countries[e].states,(e=>e.name)),m.innerText="Canada"===e?"Province":"State",v.innerText="Canada"===e?"Postal Code":"Zip",p.setAttribute("pattern","Canada"===e?c.source:d.source),p.setAttribute("maxlength","Canada"===e?"7":"10"),p.setAttribute("size","Canada"===e?"7":"10"),w()}w(),function(){const e=new DocumentFragment;a.cart.forEach((t=>{const a=$.content.cloneNode(!0),n=a.querySelector("a"),o=a.querySelector("img"),i=a.querySelector("p");return n.setAttribute("href",`/products/${t.name.toLowerCase().split(" ").join("-")}.html`),o.src=t.images.sm_a,i.textContent=`${t.name} (${t.size}) - ${t.quantity} x $${t.price}`,e.appendChild(a)})),A.appendChild(e)}(),q(h,Object.keys(a.countries),(e=>e)),T(),N.addEventListener("submit",(n=>{n.preventDefault(),async function(){E(!0),M(!0);const n={update:a.secret,name:o.value,email:i.value,streetAddress:s.value,city:u.value,country:h.value,state:l.value,zip:p.value,items:a.cart.map((e=>({type:e.type,prefix:e.prefix,size:e.size,name:e.name,color:e.color,quantity:e.quantity})))};fetch(`${t}/orders/create-payment-intent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>e.json())).then((t=>{a.secret=t.clientSecret,e("payment-price").innerText=`$${t.total.toFixed(2)}`,function(t){if(I)return;I=!0;const n=r.elements().create("card",{style:{base:{color:"#1a171b",fontFamily:"Nunito, sans-serif",fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#1a171b"}},invalid:{fontFamily:"Nunito, sans-serif",color:"#fa755a",iconColor:"#fa755a"}}});n.mount("#card-element"),n.on("change",(e=>{_.disabled=e.empty,b.textContent=e.error?e.error.message:""})),f.addEventListener("submit",(o=>{o.preventDefault(),function(t,n,o){M(!0),t.confirmCardPayment(o,{payment_method:{card:n}}).then((t=>{return t.error?(n=t.error.message,M(!1),b.textContent=n,void setTimeout((()=>{b.textContent=""}),4e3)):(M(!1),a.cart=()=>[],a.secret=null,e("result-message").classList.remove("hidden"),_.disabled=!0,C.innerText="close",C.classList.add("btn__primary"),void C.classList.remove("btn__secondary"));var n}))}(r,n,t.clientSecret)}))}(t),M(!1)}))}()})),C.addEventListener("click",(()=>E(!1))),h.addEventListener("input",(()=>T())),l.addEventListener("input",(()=>w())),p.addEventListener("input",(e=>{e.target.value=function(e){const t=e.toUpperCase();return"Canada"===h.value?6===t.length&&c.test(t)?t.substring(0,3)+" "+t.substring(3,6):t:6===t.length&&"-"!==t[5]?t.substring(0,5):t}(e.target.value,h.value)}))}(),function(){const t=e("cart-checkout");if(!t)return;const n=e("cart-subtotal"),o=e("cart-products"),i=e("cart-product-template"),s=e("cart-products-none");function r(){n.innerText=`$${a.cart.reduce(((e,t)=>e+t.price*t.quantity),0).toFixed(2)}`,a.cart.length>0?t.disabled=!1:t.disabled=!0}(function e(){if(!a.cart.length)return s.style.display="block",r();s.style.display="none";const t=new DocumentFragment;return a.cart.forEach((n=>function(t,n){const o=i.content.cloneNode(!0),s=o.querySelector(".cart__product"),c=o.querySelector("a"),d=o.querySelector("img"),u=o.querySelector("p"),l=o.querySelector("span"),m=o.querySelector(".input"),h=o.querySelector("label"),p=o.querySelector("button");return c.href=`/products/${t.name.toLowerCase().split(" ").join("-")}.html`,d.src=t.images.sm_a,d.alt=`${t.name} ${t.size} ${t.color} underwear`,u.textContent=`${t.name} (${t.size})`,l.textContent=`$${t.price}`,m.value=t.quantity,m.id=t.type,m.setAttribute("name",`${t.name} ${t.size} ${t.color}`),h.setAttribute("for",t.type),m.addEventListener("input",(()=>{m.value||(m.value=1);const e=a.inv.find((e=>e.id===t.id)).quantity;Number(m.value)>e&&(m.value=e),a.cart=e=>e.map((e=>e.id===t.id?{...e,quantity:Number(m.value)}:e)),l.textContent="$"+t.price*Number(m.value),r()})),p.setAttribute("aria-label",`Remove ${t.name} size ${t.size} color ${t.color} from cart`),p.addEventListener("click",(()=>{a.cart=e=>e.filter((e=>e.id!==t.id)),s.remove(),r(),!a.cart.length&&e()})),n.appendChild(o)}(n,t))),o.appendChild(t),r()})(),t.addEventListener("click",(()=>{a.cart.length>0&&location.assign("/checkout")}))}(),function(){const t=e("cart-link"),n=e("cart-link-mobile"),o=e("menu-mobile-list"),i=e("menu-mobile-btn"),s=(e=>{let t=!0;return()=>(t=!t,t?o.classList.add("hide"):o.classList.remove("hide"))})();function r(){if(a.cart.length>0){const e=a.cart.reduce(((e,t)=>e+t.quantity),0);t.textContent=`cart (${e})`,n.textContent=`cart (${e})`}else t.textContent="cart",n.textContent="cart"}r(),i.addEventListener("click",s),a.addHook((()=>r()))}(),function(){const t=e("hero-image");if(!t)return;const a=e=>t.src=`/assets/img/people/hero${e}.jpg`;for(let e=0;e<6;e++)document.head.appendChild(new n("link",null,{href:`/assets/img/people/hero${e}.jpg`,rel:"prefetch",as:"image"}).render());const o=function*(e){let t=0;for(;;)5===t&&(t=0),yield++t}();a(o.next().value),setInterval((()=>{a(o.next().value)}),5e3)}()})();